function getList(currentPage) {
	$
			.ajax({
				type : "post",
				url : "../comment/list",
				data : {
					"board_num" : $("#board_num").val(),
					"page" : currentPage
				},
				dataType : "json",
				success : function(rdata) {
					$("#count").text(rdata.listcount);
					if (rdata.listcount > 0) {
						$("#comment table").show();
						$("#comment tbody").empty();
						$(rdata.list)
								.each(
										function() {
											output = '';
											img = '';
											if ($("#loginid").val() == this.id) {
												img = "<img src='../resources/image/pencil2.png' width='15px' class='update'>"
														+ "<img src='../resources/image/delete.png' width='15px' class='update'>"
														+ "<input type='hidden' value='"
														+ this.num + "' >";
											}
											output += "<tr><td>" + this.id
													+ "</td>";
											output += "<td></td>";
											output += "<td>" + this.reg_date
													+ img + "</td></tr>";
											$("#comment tbody").append(output);
											$("#comment tbody tr:last").find(
													"td:nth-child(2)").text(
													this.content);
										}); // each end

						if (rdata.listcount > rdata.list.length) {
							$("#message").text("더보기")
						} else {
							$("#message").text("")
						}
					} else {
						$("#message").text("등록된 댓글이 없습니다.")
						$("#comment tbody").empty();
						$("#comment table").hide()
					}
				}
			})
}

$(function() {
	$("#comment table").hide(); // 1
	var page = 1; // 더보기에서 보여줄 페이지를 기억하는 변수
	count = parseInt($("#count").text());
	if (count != 0) { // 댓글 갯수가 0이 아니
		getList(1); // 첫 페이지의 댓글을 구해옵니다.(한페이지에 3개씩 가져옵니다.)
	} else { // 댓글이 없는 경우
		$("#message").text("등록된 댓글이 없습니다.")
	}

	$("#message").click(function() {
		getList(page++)
	});

	// 글자수 50개 제한하는 이벤트
	$('#content').on('keyup', function() {
		var length = $(this).val().length;
		if (length > 50) {
			length = 50;
			content = content.substring(0, length);
		}
		$(".float-left").text(length + "/50");
	});

	// $("#write").click(function() {
	// var content = $('#content').val();
	// if (content == null) {
	// alert("댓글을 입력하세요.")
	// return;
	// }
	//
	// $.ajax({
	// url : 'commentAdd',
	// data : {
	// id : $("#loginid").val(),
	// content : content,
	// board_num : $("#board_re_ref").val()
	// },
	// type : 'post',
	// success : function(rdata) {
	// if (rdata == 1) {
	// getList(page);
	// }
	// }
	// })
	// $('#content').val(''); // textarea 초기화
	// $('.float_left').text(''); // 입력한 글 카운트 초기화
	// })

	// 등록 또는 수정완료 버튼을 클릭한 경우
	// 버튼의 라벨이 '등록'인 경우는 댓글을 추가하는 경우
	// 버튼의 라벨이 '수정완료'인 경우는 댓글을 수정하는 경우
	$("#write").click(function() { // id가 write인 버튼을 클릭시 함수 실행
		buttonText = $("#write").text(); // 버튼의 라벨로 add할지 update할지를 결정
		content = $("#content").val(); // 작성한 댓글을 가져옴
		$(".float-left").text('총 50자까지 가능합니다.'); // 댓글수를 알려주는 버튼을 50자제한 안내문구로
													// 변경

		if (buttonText == "등록") { // 댓글을 추가하는 경우
			url = "../comment/add";
			data = { // 댓글 등록 시 넘어가는 데이터
				"id" : $("#loginid").val(), // 댓글 작성자
				"content" : content, // 댓글 내용
				"board_num" : $("#board_num").val()
			// 댓글을 단 게시글의 번호
			};
		} else { // 댓글을 수정하는 경우
			url = "../comment/update";
			// 댓글 수정 시 넘어가는 데이터
			data = {
				// 댓글 번호?
				"num" : num,
				// 수정된 댓글 내용
				"content" : content
			};
			// 다시 등록으로 변경
			$("#write").text("등록"); 
		}

		$.ajax({
			type : "post",
			url : url,
			data : data,
			success : function(result) {
				$("#content").val('')
				if(result ==1) {
					getList(page);	
				}
			}
		})
		
		$(".update").click(function(){
			var before = $("#content").val()
			Console.log(before);
		})
	})
})
